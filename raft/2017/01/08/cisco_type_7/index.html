<!DOCTYPE html>
<html xmlns="//www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Laura Pickens</title>
    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?">

    <!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/css/freelancer.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="/public/css/poole.css">-->
    <!--<link rel="stylesheet" href="/public/css/syntax.css">-->
    <link href="/css/post.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">


    <!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Cormorant:400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Marcellus+SC:400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Julius+Sans+One:400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

  <body id="page-top" class="index">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Laura Pickens</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    
                    <ul class="nav navbar-nav navbar-right">
                     <li class="hidden">
                        <a href="/"></a>
                    </li>
                    
                    
                      
                        
                      
                    
                      
                        
                      
                    
                      
                        
                        <li class="page-scroll">
                          <a class="" href="/about/">About</a>
                          </li>
                        
                      
                    
                      
                        
                      
                    
                      
                        
                        <li class="page-scroll">
                          <a class="" href="/archive/">Archive</a>
                          </li>
                        
                      
                    
                      
                    
                      
                        
                        <li class="page-scroll">
                          <a class="" href="/bookshelf/">Bookshelf</a>
                          </li>
                        
                      
                    
                      
                        
                        <li class="page-scroll">
                          <a class="" href="/contactme/">Contact Me</a>
                          </li>
                        
                      
                    
                      
                        
                      
                    
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

      <div class="content">
        <div class="container">
  <div class="page">
    <h1 class="post-title">Cisco Type 7 Encryption - What's in a hash?</h1>
    <div class="post-date"> 
    <i class="fa fa-calendar" aria-hidden="true"></i> 
    08 Jan 2017
    </div>
    <p>After setting up the initial configuration on my Catalyst 3550 switches yesterday (see <a href="/2017/01/07/fun_w_cisco/">here</a>), I decided to investigate exactly how weak the encryption on the switch’s passwords is. Turns out, a quick google search for “decrypt Cisco passwords” brings up a ton of tools and blog posts to help anyone who can gain access to the Cisco switch config decrypt the password.</p>

<p><br /></p>
<h2>Hashing vs Encryption</h2>
<p>Interestingly, Cisco has two forms of “encryption” on Catalyst switches: Type 5 and Type 7. Type 5 is used for the secret password that you can set for “enable” mode. Type 7 is used across all other passwords and is activated when you enable the password-encryption services on the switch. Cisco referring to these types as encryption is a misnomer, neither actually uses encryption to process the passwords before storing them.</p>

<p>Instead, both types refer to different hashing functions. Hashing is not the same as encryption. A hash function is intended to only be able to go one way, making it impossible to derive the original string from the hash. This is perfect for passwords as only the user needs to know what the original string is. When the user enters the password string, the system just runs it through the hash function and then compares the resulting hash to the stored hash. Encryption, on the other hand, is intended to be reversable: with a special key you can decrypt the ciphertext back into the original plaintext.</p>

<p>A good hashing function generates a fixed-length string for any amount of data entered into it that cannot be reveresed. If the input changes even a tiny bit, the resulting hash should look completely different. Hashes are commonly cracked with methods like dictionary and brute force attacks, where the attacker keeps guessing the password until login is completed successfully. For a great overview on hashing, check out <a href="//crackstation.net/hashing-security.htm">this site</a>.</p>

<p><br /></p>
<h2>Type 5 Passwords</h2>
<p>Type 5 is the stronger of the 3550’s two password types and uses the MD5 hash function to obfuscate the stored password. MD5 has been around since the early 90s, so it is no surprise that it has already been severely compromised. However, considering the 3550’s end-of-sale date was in 2006 and many of the more severe attacks on MD5 (see <a href="//en.wikipedia.org/wiki/Flame_(malware)">here</a>) came in this decade, MD5 was not a bad choice for a hashing function at the time. Today, though, we know that MD5 is vulnerable to brute-force and collision attacks. In practice, MD5 should not be used as a security mechanism, but is still often used as a checksum for basic data integrity validation caused by unintended corruption.</p>

<p><br /></p>
<h2>Type 7 Passwords</h2>
<p>The real problem is Cisco’s Type 7 passwords. These use Cisco’s own proprietary algorithm to hash each password. The hash function basically performs an XOR on each character in the password against a hex value in an array. In the resulting hash value, the first hex represents where in the array the XOR began, the rest of the hex values each represent a single character in the password XORed with the value in the array. Since the inverse of XOR happens to be XOR, if you know the array table, deciphering the password is incredibly straightforward. So not only does the length of the hash directly map to the length of the password, the hash is, by each’s very nature, easily reversable.</p>

<p>Most of the scripts I found to decode Cisco’s passwords happen to be in Perl, so for the fun of it, I decided to try my hand at a quick Python script to do the job for me. The following is based on Daren Mattews’ Perl solution found <a href="//mccltd.net/blog/?p=1034">here</a>. I did find another python solution <a href="//gist.github.com/jayswan/1927995">here</a> by jayswan which is similar to mine but didn’t work on the hash values I was pulling out of my 3550’s config.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import sys

"""
Vigenere translation table
"""
global xlat
xlat = [0x64, 0x73, 0x66, 0x64, 0x3b, 0x6b, 0x66, 0x6f, 
		0x41, 0x2c, 0x2e, 0x69, 0x79, 0x65, 0x77, 0x72, 
		0x6b, 0x6c, 0x64, 0x4a, 0x4b, 0x44, 0x48, 0x53, 
		0x55, 0x42, 0x73, 0x67, 0x76, 0x63, 0x61, 0x36, 
		0x39, 0x38, 0x33, 0x34, 0x6e, 0x63, 0x78, 0x76, 
		0x39, 0x38, 0x37, 0x33, 0x32, 0x35, 0x34, 0x6b, 
		0x3b, 0x66, 0x67, 0x38, 0x37]

"""
Decryption Algorithm
"""
def decrypt(password):

	# Break Cipher into Hex Values
	password_hex = []
	for i in range(0,len(password),2):
		password_hex.append(password[i:i+2])

	# Look Up Hex Values in Vigenere translation table
	password_chars = []
	index = int(password_hex[0],16)
	for i in range(1,len(password_hex)):
		password_chars.append(chr(int(password_hex[i],16) ^ xlat[index]))
		index = index + 1 % 53 # wrap around if necessary

	plaintext = ''.join(password_chars)

	return plaintext

"""
Main
"""
if len(sys.argv) == 2:
	ciphertext = sys.argv[1]
	print ("Cipher Text is %s" % ciphertext)
	print ("Plain Text is %s" % decrypt(ciphertext))
else:
	print ("Error - Incorrect # of args")
	print ("Example Usage: python ios7decrypt.py 002D01090A681B0F0B245E")
</code></pre>
</div>

<p>If you run the above script on the hash 002D01090A681B0F0B245E, you will happily see that at one point I had my switch’s password set to IronSpider. :) You can find this script on GitHub <a href="//github.com/pickl09/scripts/blob/master/ios7decrypt.py">here</a>.</p>


    <section class="signature">
    <div class="image">
      <img src="/images/avatar.png" class="img-responsive" alt="">
    </div>
    <div class="info">
        <div class="title">
        ABOUT <a href="/about">LAURA PICKENS</a>
        </div>
        <p>I spent my early days as a software engineer/system administrator before the cybersecurity field called to me. I am currently pursuing my MS in cybersecurity at John's Hopkins University. I work for a government contractor, performing vulnerability assessments on customer devices and IT infrastructure.</p>
        <div>
            <ul class="list-inline">

              <li>
                  <a href="//twitter.com/pickl09" class="btn-social btn-outline"><i class="fa fa-fw fa-twitter"></i></a>
              </li>
              <li>
                    <a href="//github.com/pickl09" class="btn-social btn-outline"><i class="fa fa-fw fa-github"></i></a>
              </li>
              <!--<li>
                  <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-facebook"></i></a>
              </li>
              <li>
                  <a href="#" class="btn-social btn-outline"><i class="fa fa-fw fa-linkedin"></i></a>
              </li>-->
              <li>
                  <a href="/contactme" class="btn-social btn-outline"><i class="fa fa-fw fa-envelope"></i></a>
              </li>
          </ul>
        </div>
    </div>
</section>

    <div class="related">
      <h2>Latest Posts</h2>
      <ul class="related-posts">
        
          <li>
            <h3>
              <a href="/2017/05/13/lab_pfsense_dns/">
                Home Lab - Setting Up DHCP and DNS with pfSense
                <small><i class="fa fa-calendar" aria-hidden="true"></i> 13 May 2017</small>
              </a>
            </h3>
          </li>
        
          <li>
            <h3>
              <a href="/2017/01/07/fun_w_cisco/">
                Configuring Cisco Switches
                <small><i class="fa fa-calendar" aria-hidden="true"></i> 07 Jan 2017</small>
              </a>
            </h3>
          </li>
        
      </ul>
    </div>
  </div>
</div>





      </div>

    <!-- Footer -->
<section class="footer">
        <div class="text-center">
            Copyright &copy; Laura Pickens 2017. All rights reserved. | <a href="\aboutsite.html">About this site</a>
        </div>
</section>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll visible-xs visible-sm">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

    <!-- jQuery -->
    <script src="/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="/js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="/js/jqBootstrapValidation.js"></script>
    <script src="/js/contact_me.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/js/freelancer.js"></script>

  </body>
</html>
